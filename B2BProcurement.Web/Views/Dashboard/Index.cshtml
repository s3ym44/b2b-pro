@model B2BProcurement.Controllers.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    ViewData["PageTitle"] = "Dashboard";
    ViewData["Breadcrumb"] = "Ana Sayfa";
}

@section Styles {
<style>
    .stat-card {
        border: none;
        border-radius: var(--radius-lg);
        padding: 24px;
        position: relative;
        overflow: hidden;
        transition: var(--transition-base);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }
    
    .stat-card .stat-icon {
        width: 56px;
        height: 56px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #fff;
    }
    
    .stat-card .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 4px;
    }
    
    .stat-card .stat-label {
        font-size: 13px;
        color: var(--gray-500);
        font-weight: 500;
    }
    
    .stat-card .stat-trend {
        font-size: 12px;
        font-weight: 600;
    }
    
    .stat-card .stat-trend.up { color: var(--success); }
    .stat-card .stat-trend.down { color: var(--danger); }
    
    .stat-card::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        pointer-events: none;
    }
    
    .chart-card {
        border: none;
        border-radius: var(--radius-lg);
        background: var(--white);
        box-shadow: var(--shadow-sm);
    }
    
    .chart-card .card-header {
        background: transparent;
        border-bottom: 1px solid var(--gray-100);
        padding: 20px 24px;
    }
    
    .chart-card .card-body {
        padding: 24px;
    }
    
    .activity-item {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        padding: 16px 0;
        border-bottom: 1px solid var(--gray-100);
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        flex-shrink: 0;
    }
    
    .activity-icon.primary { background: rgba(123, 47, 247, 0.1); color: var(--primary); }
    .activity-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
    .activity-icon.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
    .activity-icon.danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
    
    .activity-content h6 {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 4px;
    }
    
    .activity-content p {
        font-size: 13px;
        color: var(--gray-500);
        margin: 0;
    }
    
    .activity-time {
        font-size: 12px;
        color: var(--gray-400);
        white-space: nowrap;
    }
    
    .rfq-item {
        padding: 16px;
        border-radius: var(--radius-md);
        background: var(--gray-50);
        margin-bottom: 12px;
        transition: var(--transition-fast);
    }
    
    .rfq-item:hover {
        background: var(--gray-100);
    }
    
    .rfq-item:last-child {
        margin-bottom: 0;
    }
    
    .rfq-title {
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 8px;
    }
    
    .rfq-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 13px;
        color: var(--gray-500);
    }
    
    .rfq-meta span i {
        margin-right: 6px;
        color: var(--gray-400);
    }
    
    .deadline-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-bottom: 8px;
        background: var(--gray-50);
    }
    
    .deadline-item.urgent {
        background: rgba(239, 68, 68, 0.05);
        border-left: 3px solid var(--danger);
    }
    
    .deadline-item.warning {
        background: rgba(245, 158, 11, 0.05);
        border-left: 3px solid var(--warning);
    }
    
    .deadline-days {
        font-weight: 700;
        padding: 4px 12px;
        border-radius: var(--radius-sm);
        font-size: 12px;
    }
    
    .deadline-days.urgent {
        background: var(--danger);
        color: #fff;
    }
    
    .deadline-days.warning {
        background: var(--warning);
        color: #fff;
    }
    
    .deadline-days.normal {
        background: var(--gray-200);
        color: var(--gray-700);
    }
</style>
}

<div class="row g-4 mb-4">
    <!-- Aktif Tekliflerim -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-value text-white">@Model.Summary.ActiveQuotations</div>
                    <div class="stat-label text-white-50">Aktif Tekliflerim</div>
                </div>
                <div class="stat-icon" style="background: rgba(255,255,255,0.2);">
                    <i class="fas fa-file-invoice"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gelen Teklifler -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-value text-white">@Model.Summary.IncomingRfqs</div>
                    <div class="stat-label text-white-50">Gelen Talepler</div>
                </div>
                <div class="stat-icon" style="background: rgba(255,255,255,0.2);">
                    <i class="fas fa-inbox"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bekleyen Cevaplar -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-value text-white">@Model.Summary.PendingResponses</div>
                    <div class="stat-label text-white-50">Bekleyen Cevaplar</div>
                </div>
                <div class="stat-icon" style="background: rgba(255,255,255,0.2);">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bu Ayki Toplam -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-value text-white">@Model.Summary.MonthlyTotal.ToString("C0")</div>
                    <div class="stat-label text-white-50">Bu Ayki Toplam</div>
                </div>
                <div class="stat-icon" style="background: rgba(255,255,255,0.2);">
                    <i class="fas fa-coins"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <!-- Teklif Trendi Grafiği -->
    <div class="col-xl-8">
        <div class="chart-card card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line me-2 text-primary"></i>Son 6 Ay Teklif Trendi
                </h5>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="btn btn-outline-secondary active">Aylık</button>
                    <button type="button" class="btn btn-outline-secondary">Haftalık</button>
                </div>
            </div>
            <div class="card-body">
                <canvas id="trendChart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Yaklaşan Bitiş Tarihleri -->
    <div class="col-xl-4">
        <div class="chart-card card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-hourglass-half me-2 text-warning"></i>Yaklaşan Bitiş Tarihleri
                </h5>
            </div>
            <div class="card-body">
                @if (Model.UpcomingDeadlines.Any())
                {
                    @foreach (var deadline in Model.UpcomingDeadlines)
                    {
                        var urgencyClass = deadline.DaysRemaining <= 1 ? "urgent" : (deadline.DaysRemaining <= 3 ? "warning" : "");
                        var daysClass = deadline.DaysRemaining <= 1 ? "urgent" : (deadline.DaysRemaining <= 3 ? "warning" : "normal");
                        
                        <div class="deadline-item @urgencyClass">
                            <div>
                                <div class="fw-semibold text-gray-800">@deadline.Title</div>
                                <small class="text-muted">#@deadline.RfqNumber · @deadline.Deadline.ToString("dd MMM")</small>
                            </div>
                            <span class="deadline-days @daysClass">
                                @(deadline.DaysRemaining == 0 ? "Bugün" : $"{deadline.DaysRemaining} gün")
                            </span>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-check-circle fa-2x mb-2"></i>
                        <p class="mb-0">Yaklaşan bitiş tarihi yok</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Son Aktiviteler -->
    <div class="col-xl-6">
        <div class="chart-card card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-history me-2 text-info"></i>Son Aktiviteler
                </h5>
                <a href="#" class="btn btn-sm btn-light">Tümünü Gör</a>
            </div>
            <div class="card-body">
                @if (Model.RecentActivities.Any())
                {
                    @foreach (var activity in Model.RecentActivities)
                    {
                        <div class="activity-item">
                            <div class="activity-icon @activity.TypeColor">
                                <i class="fas @activity.TypeIcon"></i>
                            </div>
                            <div class="activity-content flex-grow-1">
                                <h6>@activity.Type</h6>
                                <p>@activity.Description</p>
                            </div>
                            <div class="activity-time">
                                @activity.Date.ToString("dd MMM HH:mm")
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p class="mb-0">Henüz aktivite yok</p>
                    </div>
                }
            </div>
        </div>
    </div>
    
    <!-- Gelen RFQ'lar -->
    <div class="col-xl-6">
        <div class="chart-card card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-paper-plane me-2 text-success"></i>Gelen Teklif Talepleri
                </h5>
                <a asp-controller="Rfq" asp-action="Index" class="btn btn-sm btn-primary">
                    Tümünü Gör
                </a>
            </div>
            <div class="card-body">
                @if (Model.IncomingRfqs.Any())
                {
                    @foreach (var rfq in Model.IncomingRfqs)
                    {
                        <div class="rfq-item">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <a href="@Url.Action("Details", "Rfq", new { id = rfq.Id })" class="rfq-title text-decoration-none">
                                    @rfq.Title
                                </a>
                                <span class="badge bg-primary-light text-primary">@rfq.ItemCount kalem</span>
                            </div>
                            <div class="rfq-meta">
                                <span><i class="fas fa-building"></i>@rfq.CompanyName</span>
                                <span><i class="fas fa-industry"></i>@rfq.Sector</span>
                                <span><i class="fas fa-calendar"></i>@rfq.Deadline.ToString("dd MMM yyyy")</span>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-folder-open fa-2x mb-2"></i>
                        <p class="mb-0">Henüz gelen teklif talebi yok</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
    // Trend Chart
    const ctx = document.getElementById('trendChart').getContext('2d');
    
    const trendData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.MonthlyTrend));
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: trendData.map(d => d.month),
            datasets: [
                {
                    label: 'RFQ Sayısı',
                    data: trendData.map(d => d.rfqCount),
                    borderColor: '#7b2ff7',
                    backgroundColor: 'rgba(123, 47, 247, 0.1)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2,
                    pointBackgroundColor: '#7b2ff7',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4
                },
                {
                    label: 'Teklif Sayısı',
                    data: trendData.map(d => d.quotationCount),
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2,
                    pointBackgroundColor: '#00d4ff',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        usePointStyle: true,
                        padding: 20
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        borderDash: [5, 5]
                    },
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
</script>
}
