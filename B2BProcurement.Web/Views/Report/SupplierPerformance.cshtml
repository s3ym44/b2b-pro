@model B2BProcurement.Controllers.SupplierPerformanceViewModel
@{
    ViewData["Title"] = "Tedarikçi Performansı";
    ViewData["PageTitle"] = "Tedarikçi Performans Raporu";
    ViewData["Breadcrumb"] = "Raporlar";
}

@section Styles {
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
<style>
    /* Summary Cards */
    .summary-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 24px;
    }
    
    .summary-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-sm);
        text-align: center;
    }
    
    .summary-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 12px;
    }
    
    .summary-icon.blue { background: #DBEAFE; color: #2563EB; }
    .summary-icon.green { background: #DCFCE7; color: #16A34A; }
    .summary-icon.purple { background: #EDE9FE; color: #7C3AED; }
    
    .summary-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--gray-800);
    }
    
    .summary-label {
        font-size: 14px;
        color: var(--gray-500);
    }
    
    /* Chart Card */
    .chart-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        margin-bottom: 24px;
        overflow: hidden;
    }
    
    .chart-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--gray-100);
    }
    
    .chart-header h5 {
        margin: 0;
        font-weight: 600;
        color: var(--gray-800);
    }
    
    .chart-body {
        padding: 24px;
    }
    
    /* Table Card */
    .table-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
    }
    
    .table-card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--gray-100);
    }
    
    .table-card-header h5 {
        margin: 0;
        font-weight: 600;
        color: var(--gray-800);
    }
    
    /* DataTable */
    .dataTables_wrapper {
        padding: 20px;
    }
    
    table.dataTable thead th {
        background: var(--gray-50);
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        color: var(--gray-600);
        padding: 14px 16px !important;
    }
    
    table.dataTable tbody td {
        padding: 16px !important;
        vertical-align: middle;
    }
    
    /* Progress Bar */
    .win-rate-bar {
        width: 100%;
        height: 8px;
        background: var(--gray-200);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .win-rate-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease;
    }
    
    .win-rate-fill.high { background: #10B981; }
    .win-rate-fill.medium { background: #F59E0B; }
    .win-rate-fill.low { background: #EF4444; }
    
    .win-rate-text {
        font-size: 13px;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 4px;
    }
    
    /* Amount Badge */
    .amount-badge {
        font-weight: 700;
        color: var(--gray-800);
    }
    
    /* Rank Badge */
    .rank-badge {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 12px;
    }
    
    .rank-badge.gold { background: #FEF3C7; color: #D97706; }
    .rank-badge.silver { background: #E5E7EB; color: #374151; }
    .rank-badge.bronze { background: #FED7AA; color: #C2410C; }
    .rank-badge.default { background: var(--gray-100); color: var(--gray-600); }
</style>
}

<!-- Summary Row -->
<div class="summary-row">
    <div class="summary-card">
        <div class="summary-icon blue"><i class="fas fa-building"></i></div>
        <div class="summary-value">@Model.TotalSuppliers</div>
        <div class="summary-label">Toplam Tedarikçi</div>
    </div>
    <div class="summary-card">
        <div class="summary-icon green"><i class="fas fa-file-invoice-dollar"></i></div>
        <div class="summary-value">@Model.TotalQuotations</div>
        <div class="summary-label">Alınan Teklif</div>
    </div>
    <div class="summary-card">
        <div class="summary-icon purple"><i class="fas fa-chart-line"></i></div>
        <div class="summary-value">@Model.AvgQuotationsPerSupplier.ToString("N1")</div>
        <div class="summary-label">Ortalama Teklif/Tedarikçi</div>
    </div>
</div>

<!-- Top Suppliers Chart -->
<div class="chart-card">
    <div class="chart-header">
        <h5><i class="fas fa-trophy me-2"></i>En Başarılı Tedarikçiler</h5>
    </div>
    <div class="chart-body">
        <canvas id="suppliersChart" height="300"></canvas>
    </div>
</div>

<!-- Suppliers Table -->
<div class="table-card">
    <div class="table-card-header">
        <h5><i class="fas fa-list me-2"></i>Tüm Tedarikçiler</h5>
    </div>
    <table id="suppliersTable" class="table table-hover mb-0" style="width:100%">
        <thead>
            <tr>
                <th style="width: 60px;">Sıra</th>
                <th>Tedarikçi</th>
                <th>Teklif Sayısı</th>
                <th>Onaylanan</th>
                <th>Kazanma Oranı</th>
                <th>Ortalama Tutar</th>
                <th>Toplam Tutar</th>
            </tr>
        </thead>
        <tbody>
            @{ var rank = 1; }
            @foreach (var supplier in Model.Suppliers)
            {
                var rankClass = rank switch
                {
                    1 => "gold",
                    2 => "silver",
                    3 => "bronze",
                    _ => "default"
                };
                var winRateClass = supplier.WinRate >= 50 ? "high" : (supplier.WinRate >= 25 ? "medium" : "low");
                
                <tr>
                    <td>
                        <span class="rank-badge @rankClass">@rank</span>
                    </td>
                    <td>
                        <strong>@supplier.SupplierName</strong>
                    </td>
                    <td>
                        <span class="badge bg-light text-dark">@supplier.TotalQuotations</span>
                    </td>
                    <td>
                        <span class="badge bg-success">@supplier.ApprovedQuotations</span>
                    </td>
                    <td>
                        <div class="win-rate-text">%@supplier.WinRate.ToString("N1")</div>
                        <div class="win-rate-bar">
                            <div class="win-rate-fill @winRateClass" style="width: @supplier.WinRate%"></div>
                        </div>
                    </td>
                    <td>
                        <span class="amount-badge">@supplier.AverageAmount.ToString("N0") TRY</span>
                    </td>
                    <td>
                        <span class="amount-badge">@supplier.TotalAmount.ToString("N0") TRY</span>
                    </td>
                </tr>
                rank++;
            }
        </tbody>
    </table>
</div>

@section Scripts {
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // DataTable
    $(document).ready(function() {
        $('#suppliersTable').DataTable({
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/tr.json'
            },
            order: [[3, 'desc']],
            pageLength: 10
        });
    });
    
    // Suppliers Chart
    const ctx = document.getElementById('suppliersChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.TopSuppliersChart.Select(s => s.Label))),
            datasets: [{
                label: 'Onaylanan Teklif',
                data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.TopSuppliersChart.Select(s => s.Value))),
                backgroundColor: [
                    'rgba(251, 191, 36, 0.8)',
                    'rgba(156, 163, 175, 0.8)',
                    'rgba(251, 146, 60, 0.8)',
                    'rgba(139, 92, 246, 0.7)',
                    'rgba(59, 130, 246, 0.7)',
                    'rgba(16, 185, 129, 0.7)',
                    'rgba(236, 72, 153, 0.7)',
                    'rgba(245, 158, 11, 0.7)',
                    'rgba(239, 68, 68, 0.7)',
                    'rgba(20, 184, 166, 0.7)'
                ],
                borderRadius: 6
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });
</script>
}
