@* Navbar Partial View *@
@{
    var userName = User.Identity?.Name ?? "Kullanıcı";
    var userInitials = userName.Length >= 2 ? userName.Substring(0, 2).ToUpper() : "US";
}

<nav class="topbar">
    <div class="topbar-left">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Breadcrumb -->
        @if (ViewData["Breadcrumb"] != null)
        {
            <nav aria-label="breadcrumb" class="d-none d-md-block">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item">
                        <a href="/"><i class="fas fa-home"></i></a>
                    </li>
                    @foreach (var item in (List<(string, string)>)ViewData["Breadcrumb"]!)
                    {
                        if (string.IsNullOrEmpty(item.Item2))
                        {
                            <li class="breadcrumb-item active">@item.Item1</li>
                        }
                        else
                        {
                            <li class="breadcrumb-item"><a href="@item.Item2">@item.Item1</a></li>
                        }
                    }
                </ol>
            </nav>
        }
        
        <!-- Search Box -->
        <div class="search-box d-none d-lg-flex">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Ara..." class="form-control" id="globalSearch">
        </div>
    </div>
    
    <div class="topbar-right">
        <!-- Language Selector -->
        <div class="dropdown topbar-item">
            <button class="topbar-btn" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="https://flagcdn.com/w20/tr.png" alt="TR" class="flag-icon" id="currentFlag">
                <span class="d-none d-md-inline" id="currentLang">TR</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <a class="dropdown-item" href="#" onclick="changeLanguage('tr')">
                        <img src="https://flagcdn.com/w20/tr.png" class="flag-icon me-2"> Türkçe
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" onclick="changeLanguage('en')">
                        <img src="https://flagcdn.com/w20/gb.png" class="flag-icon me-2"> English
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Notifications -->
        <partial name="_Notifications" />
        
        <!-- User Menu -->
        <div class="dropdown topbar-item user-menu">
            <button class="topbar-btn user-btn" data-bs-toggle="dropdown" aria-expanded="false">
                <div class="user-avatar">
                    <span>@userInitials</span>
                </div>
                <div class="user-info d-none d-md-block">
                    <span class="user-name">@userName</span>
                    <span class="user-role">@(ViewBag.UserRole ?? "Kullanıcı")</span>
                </div>
                <i class="fas fa-chevron-down d-none d-md-inline"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li class="dropdown-header">
                    <strong>@userName</strong>
                    <small class="d-block text-muted">@(ViewBag.UserEmail ?? "")</small>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item" href="/Account/Profile">
                        <i class="fas fa-user me-2"></i> Profilim
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="/Settings/Company">
                        <i class="fas fa-building me-2"></i> Şirket Ayarları
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="/Settings/Notifications">
                        <i class="fas fa-bell me-2"></i> Bildirim Ayarları
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item text-danger" href="/Account/Logout">
                        <i class="fas fa-sign-out-alt me-2"></i> Çıkış Yap
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
function changeLanguage(lang) {
    // Set cookie for language preference
    document.cookie = `language=${lang};path=/;max-age=31536000`;
    
    // Update UI
    const flagUrl = lang === 'tr' ? 'https://flagcdn.com/w20/tr.png' : 'https://flagcdn.com/w20/gb.png';
    document.getElementById('currentFlag').src = flagUrl;
    document.getElementById('currentLang').textContent = lang.toUpperCase();
    
    // Optionally reload or make AJAX call to change language
    // location.reload();
}
</script>
